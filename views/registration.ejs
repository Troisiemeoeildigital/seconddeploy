


<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Kitech - Registration</title>
      <!-- Favicon -->
       <link rel="stylesheet" href="./mvp.css" />
       
      <style>
         .form-control {
            background: #f3f6fd;
         }
     
      </style>
   </head>
  <body class=" ">
   <nav class="navbar navbar-expand-lg navbar-light bg-white" style="margin-top: 0;
   padding: 0;
   height: 9em;">
      <div class="container">
          <a class="navbar-brand" href="/">
              <img src="./ci_logo.jpg" alt="brand" style="width: 22em;">
          </a>
      </div>
  </nav>
    <!-- loader Start -->
    
    <!-- loader END -->
    
      <div class="wrapper" style="    background-color: #f3f6fd;">
      <section class="login-content">
         <div class="container">
            <div class="row  justify-content-center height-self-center" style="align-items: flex-start;
            margin-top: 12%;">
               <div class="col-lg-8">
                  <div class="card auth-card">
                     <div class="card-body p-0">
                        <div class="d-flex align-items-center auth-content">
                           <div class="col-lg-12 align-self-center">
                              <div class="p-3">
                                 <h2 class="mb-2" style="text-align: center; color: #1f1c2f;">Sign Up</h2>
                 
                                 <form style="margin-top: 5%;" id="signup">
                                    <div class="row">
                                       <div class="col-lg-6">
                                          <div class="floating-label form-group">
                                             <input class="floating-input form-control" type="text" id="firstname" placeholder=" ">
                                             <label>ÏÑ±Ìï®</label>
                                          </div>
                                       </div>
                                       <div class="col-lg-6">
                                          <div class="floating-label form-group">
                                             <input class="floating-input form-control" type="tel" pattern="[0-9]{3}-[0-9]{4}-[0-9]{4}"  id="phoneNumber" placeholder=" ">
                                             <label style="margin-top: -2.8%;">Ìú¥ÎåÄÏ†ÑÌôîÎ≤àÌò∏</label>
                                             <p style="font-size:12px">Îã§Ïùå ÌòïÏãùÏúºÎ°ú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî: 010-XXXX-XXXX</p>
                                          </div>
                                       </div>
                                       <div class="col-lg-6">
                                          <div class="floating-label form-group">
                                             <input class="floating-input form-control" type="email" id="email" placeholder=" ">
                                             <label>Ïù¥Î©îÏùº Ï£ºÏÜå</label>
                                          </div>
                                       </div>
                                       <div class="col-lg-3">
                                          <div class="floating-label form-group">
                                             <input class="floating-input form-control" type="text" id="companyname" placeholder=" ">
                                             <label>ÌöåÏÇ¨Î™Ö</label>
                                          </div>
                                       </div>
                                       <div class="col-lg-3">
                                          <div class="floating-label form-group">
                                             <input class="floating-input form-control" type="text" id="division" placeholder=" ">
                                             <label>Î∂ÄÏÑúÎ™Ö </label>
                                          </div>
                                       </div>
                                       <div class="col-lg-12">
                                         <div class="floating-label form-group">
                                             <input class="floating-input form-control" type="password" id="password" placeholder=" ">
                                             <label>ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                                          </div>
                                       </div>
                                    </div>
                                    <div class="row" style="
                                                            display: flex;
                                                            flex-wrap: wrap;
                                                            margin-right: -15px;
                                                            margin-left: -15px;
                                                            flex-direction: row-reverse;
                                                            justify-content: space-between;
                                                            align-items: center;
                                                               ">
    <button type="submit" class="btn btn-primary float-right" style="background-color: #fb8500;
    border: 0;">ÌöåÏõêÍ∞ÄÏûÖ</button>
                                    <p class="mt-3">
                                       Ïù¥ÎØ∏ Í≥ÑÏ†ïÏù¥ ÏûàÏúºÏã†Í∞ÄÏöî?  <a href="./login" class="text-primary">Î°úÍ∑∏Ïù∏</a>
                                    </p>
                                    </div>
                                
                                 </form>
                              </div>
                           </div>
                         
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </section>
      </div>
      
     <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-auth.js"></script>
      <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-firestore.js"></script>
        <script  src="https://www.gstatic.com/firebasejs/7.14.1/firebase-functions.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>

  <%- include('config/config'); %>
      

      <script type="module">
   

       const app = firebase.initializeApp(firebaseConfig);

        firebase.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION);
         const db = firebase.firestore();
         const functions = firebase.functions(app)
         

console.log("im updated!")
        document
          .getElementById("signup")
          .addEventListener("submit", (event) => {
            event.preventDefault();
            
            const firstname = document.getElementById('firstname').value;
            const login = document.getElementById('email').value;
               const phoneNumber = document.getElementById('phoneNumber').value;
            const password = document.getElementById('password').value;
            const companyname = document.getElementById('companyname').value;
            const division = document.getElementById('division').value;

  
            firebase
            .auth()
            .createUserWithEmailAndPassword(login, password)
            .then( async  ({ user }) => {
                user.updateProfile({
             displayName: firstname,
             })
               db.collection('users').add({
                  fullName: firstname,
                  userEmail: login,
                   phoneNumber: phoneNumber,
                  userCompanyname: companyname,
                  userID: user.uid,
                  division: division,
                  requestType: false,
                  requestStatus: "üî¥",
                  requestRole: "No Request has been sent.",
                  userRole: "Default"
               })
               let timerInterval
                        Swal.fire({
                        title: 'Please Wait...',
                        html: "We're creating your account.",
                        timer: 3000,
                        timerProgressBar: true,
                        didOpen: () => {
                           Swal.showLoading()
                           const b = Swal.getHtmlContainer().querySelector('b')
                           timerInterval = setInterval(() => {
                              b.textContent = Swal.getTimerLeft()
                           }, 100)
                        },
                        willClose: () => {
                           clearInterval(timerInterval)
                        }
                        }).then((result) => {
                        /* Read more about handling dismissals below */
                        if (result.dismiss === Swal.DismissReason.timer) {
                           console.log('I was closed by the timer')
                        }
                        })
               console.log(user.email)
                 const addDefaultRole = functions.httpsCallable('addDefaultRole');
                  addDefaultRole({email: user.email}).then(result => {
                     console.log(result);
                     Swal.fire(
                        'Í≥ÑÏ†ï ÏÉùÏÑ±Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!',
                        `ÏïÑÎûò Í≥ÑÏ†ïÏúºÎ°ú Î°úÍ∑∏Ïù∏ÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§:
                        <br />
                        Email ID: ${login}
                        <br />
                        ÎπÑÎ∞ÄÎ≤àÌò∏: ${password}`,
                        'success'
                        )
                  })
                return user.getIdToken().then(  (idToken) => {
                  return fetch("/sessionLogin", {
                    method: "POST",
                    headers: {
                      Accept: "application/json",
                      "Content-Type": "application/json",
                      "CSRF-Token": Cookies.get("XSRF-TOKEN"),
                    },
                    body: JSON.stringify({ idToken }),
                  });
                });
              })

            //   .then(() => {
            //     return firebase.auth().signOut();
            //   })
         
            return false;
          });


      </script>
    
    <!-- Backend Bundle JavaScript -->
    <script src="./backend-bundle.min.js"></script>
    
    <!-- Table Treeview JavaScript -->
    <script src="./table-treeview.js"></script>
    
    <!-- Chart Custom JavaScript -->
    <script src="./customizer.js"></script>
    
    <!-- Chart Custom JavaScript -->
    <script async src="./chart-custom.js"></script>
    
    <!-- app JavaScript -->
    <script src="./app.js"></script>
  </body>
</html>