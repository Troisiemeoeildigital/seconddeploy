


<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Kitech - Registration</title>
      <!-- Favicon -->
       <link rel="stylesheet" href="./mvp.css" />
      <style>
         .form-control {
            background: #f3f6fd;
         }
     
      </style>
   </head>
  <body class=" ">
    <!-- loader Start -->
    
    <!-- loader END -->
    
      <div class="wrapper" style="    background-color: #f3f6fd;">
      <section class="login-content">
         <div class="container">
            <div class="row align-items-center justify-content-center height-self-center">
               <div class="col-lg-8">
                  <div class="card auth-card">
                     <div class="card-body p-0">
                        <div class="d-flex align-items-center auth-content">
                           <div class="col-lg-12 align-self-center">
                              <div class="p-3">
                                 <h2 class="mb-2" style="text-align: center; color: #1f1c2f;">Sign Up</h2>
                 
                                 <form style="margin-top: 5%;" id="signup">
                                    <div class="row">
                                       <div class="col-lg-6">
                                          <div class="floating-label form-group">
                                             <input class="floating-input form-control" type="text" id="firstname" placeholder=" ">
                                             <label>ì„±í•¨</label>
                                          </div>
                                       </div>
                                       <div class="col-lg-6">
                                          <div class="floating-label form-group">
                                             <input class="floating-input form-control" type="tel" pattern="[0-9]{3}-[0-9]{4}-[0-9]{4}"  id="phoneNumber" placeholder=" ">
                                             <label style="margin-top: -2.8%;">íœ´ëŒ€ì „í™”ë²ˆí˜¸</label>
                                             <p style="font-size:12px">ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”: 010-XXXX-XXXX</p>
                                          </div>
                                       </div>
                                       <div class="col-lg-6">
                                          <div class="floating-label form-group">
                                             <input class="floating-input form-control" type="email" id="email" placeholder=" ">
                                             <label>ì´ë©”ì¼ ì£¼ì†Œ</label>
                                          </div>
                                       </div>
                                       <div class="col-lg-3">
                                          <div class="floating-label form-group">
                                             <input class="floating-input form-control" type="text" id="companyname" placeholder=" ">
                                             <label>íšŒì‚¬ëª…</label>
                                          </div>
                                       </div>
                                       <div class="col-lg-3">
                                          <div class="floating-label form-group">
                                             <input class="floating-input form-control" type="text" id="division" placeholder=" ">
                                             <label>ë¶€ì„œëª… </label>
                                          </div>
                                       </div>
                                       <div class="col-lg-12">
                                         <div class="floating-label form-group">
                                             <input class="floating-input form-control" type="password" id="password" placeholder=" ">
                                             <label>ë¹„ë°€ë²ˆí˜¸</label>
                                          </div>
                                       </div>
                                    </div>
                                    <div class="row" style="
                                                            display: flex;
                                                            flex-wrap: wrap;
                                                            margin-right: -15px;
                                                            margin-left: -15px;
                                                            flex-direction: row-reverse;
                                                            justify-content: space-between;
                                                            align-items: center;
                                                               ">
    <button type="submit" class="btn btn-primary float-right" style="background-color: #1f1c2f;
    border: 0;">íšŒì›ê°€ì…</button>
                                    <p class="mt-3">
                                       ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?  <a href="./login" class="text-primary">ë¡œê·¸ì¸</a>
                                    </p>
                                    </div>
                                
                                 </form>
                              </div>
                           </div>
                         
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </section>
      </div>
      
     <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-auth.js"></script>
      <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-firestore.js"></script>
        <script  src="https://www.gstatic.com/firebasejs/7.14.1/firebase-functions.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>

  <%- include('config/config'); %>
      

      <script type="module">
   

       const app = firebase.initializeApp(firebaseConfig);

        firebase.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION);
         const db = firebase.firestore();
         const functions = firebase.functions(app)
         

console.log("im updated!")
        document
          .getElementById("signup")
          .addEventListener("submit", (event) => {
            event.preventDefault();
            
            const firstname = document.getElementById('firstname').value;
            const login = document.getElementById('email').value;
               const phoneNumber = document.getElementById('phoneNumber').value;
            const password = document.getElementById('password').value;
            const companyname = document.getElementById('companyname').value;
            const division = document.getElementById('division').value;

  
            firebase
            .auth()
            .createUserWithEmailAndPassword(login, password)
            .then( async  ({ user }) => {
                user.updateProfile({
             displayName: firstname,
             })
               db.collection('users').add({
                  fullName: firstname,
                  userEmail: login,
                   phoneNumber: phoneNumber,
                  userCompanyname: companyname,
                  userID: user.uid,
                  division: division,
                  requestType: false,
                  requestStatus: "ğŸ”´",
                  requestRole: "No Request has been sent.",
                  userRole: "Default"
               })
               Swal.fire(
                        'ê³„ì • ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!',
                        `ì•„ë˜ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
                        <br />
                        Email ID: ${login}
                        <br />
                        ë¹„ë°€ë²ˆí˜¸: ${password}`,
                        'success'
                        )
               console.log(user.email)
                 const addDefaultRole = functions.httpsCallable('addDefaultRole');
                  addDefaultRole({email: user.email}).then(result => {
                     console.log(result);
                  })
                return user.getIdToken().then(  (idToken) => {
                  return fetch("/sessionLogin", {
                    method: "POST",
                    headers: {
                      Accept: "application/json",
                      "Content-Type": "application/json",
                      "CSRF-Token": Cookies.get("XSRF-TOKEN"),
                    },
                    body: JSON.stringify({ idToken }),
                  });
                });
              })

            //   .then(() => {
            //     return firebase.auth().signOut();
            //   })
         
            return false;
          });


      </script>
    
    <!-- Backend Bundle JavaScript -->
    <script src="./backend-bundle.min.js"></script>
    
    <!-- Table Treeview JavaScript -->
    <script src="./table-treeview.js"></script>
    
    <!-- Chart Custom JavaScript -->
    <script src="./customizer.js"></script>
    
    <!-- Chart Custom JavaScript -->
    <script async src="./chart-custom.js"></script>
    
    <!-- app JavaScript -->
    <script src="./app.js"></script>
  </body>
</html>